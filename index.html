<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Poker Panel PRO con Firebase</title>
</head>
<body>
<h1>Panel de Poker conectado a Firebase</h1>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDbMG8Yj3JCMmlYWMlxo_wndA3Hrm1udYE",
    authDomain: "team-poker-lucho.firebaseapp.com",
    projectId: "team-poker-lucho",
    storageBucket: "team-poker-lucho.firebasestorage.app",
    messagingSenderId: "633781003445",
    appId: "1:633781003445:web:b6e7247e3d4e7cf900cafc"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  async function saveData(key, data) {
    const colRef = db.collection(key);
    const snapshot = await colRef.get();
    snapshot.forEach(doc => doc.ref.delete());
    for (const row of data) {
      await colRef.add(row);
    }
  }

  async function loadData(key) {
    const colRef = db.collection(key);
    const snapshot = await colRef.get();
    return snapshot.docs.map(doc => doc.data());
  }
</script>

<p>Este es un esqueleto con Firebase listo. Reemplaza el contenido con tu lógica original de Poker Panel y funcionará con Firestore.</p>

<!-- ==== Firebase bridge (keeps localStorage UI, syncs with Firestore) ==== -->
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js"></script>
<script>
(function(){
  try{
    const firebaseConfig = {
      apiKey: "AIzaSyDbMG8Yj3JCMmlYWMlxo_wndA3Hrm1udYE",
      authDomain: "team-poker-lucho.firebaseapp.com",
      projectId: "team-poker-lucho",
      storageBucket: "team-poker-lucho.firebasestorage.app",
      messagingSenderId: "633781003445",
      appId: "1:633781003445:web:b6e7247e3d4e7cf900cafc"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Helper to write entire array for a given key to Firestore (replace-all strategy)
    async function pushKeyToFirestore(key, data){
      try{
        const col = db.collection(key);
        const snap = await col.get();
        const batchDeletes = [];
        snap.forEach(doc => batchDeletes.push(doc.ref.delete()));
        await Promise.all(batchDeletes);
        const writes = (data||[]).map(row => col.add(row));
        await Promise.all(writes);
      }catch(e){ console.warn('Firestore push error for', key, e); }
    }

    // Bootstrap from Firestore only if localStorage for that key is empty
    async function bootstrapFromFirestore(){
      const keys = ['badbits','flips','torneos','torneos_eliminados'];
      let changed = false;
      for(const key of keys){
        const existing = localStorage.getItem(key);
        if(!existing || existing === '[]'){
          try{
            const snap = await db.collection(key).get();
            if(!snap.empty){
              const rows = snap.docs.map(d=>d.data());
              localStorage.setItem(key, JSON.stringify(rows));
              changed = true;
            }
          }catch(e){ console.warn('Bootstrap error for', key, e); }
        }
      }
      if(typeof updateAll === 'function' && changed){
        try{ updateAll(); }catch(e){ console.warn('updateAll after bootstrap', e); }
      }
    }

    // Patch saveData to also sync Firestore (keeps UI logic intact)
    const _saveData = window.saveData;
    window.saveData = function(key, data){
      try{ _saveData(key, data); }catch(e){ console.warn('local saveData failed', e); }
      try{ pushKeyToFirestore(key, data); }catch(e){ console.warn('firestore sync failed', e); }
    };

    // Initial sync on load
    document.addEventListener('DOMContentLoaded', bootstrapFromFirestore);

  }catch(err){ console.warn('Firebase bridge init error', err); }
})();
</script>

</body>
</html>