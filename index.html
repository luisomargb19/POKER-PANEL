<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Poker Panel PRO</title>
<style>
:root{
  --green:#10b981; --red:#ef4444; --blue:#3b82f6; --blue-dark:#1e3a8a;
  --bg:linear-gradient(to right, #3b82f6, #60a5fa, #93c5fd);
}
*{box-sizing:border-box}
body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; background:var(--bg); min-height:100vh; display:flex; align-items:center; justify-content:center;}
main{width:min(1200px,95vw); background:#fff; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.25); overflow:hidden;}
header{background:var(--blue-dark); color:#fff; padding:16px 20px; text-align:center}
nav{display:flex; flex-wrap:wrap; gap:8px; justify-content:center; margin-top:10px}
.tab{background:var(--blue); color:#fff; border:none; padding:8px 12px; border-radius:8px; cursor:pointer}
.tab.active{background:#1d4ed8}
section{display:none; padding:20px}
section.active{display:block}
h2 { margin:0 0 4px; text-align:center; }
.quote { margin:6px 0 14px; font-style:italic; color:#1e3a8a; text-align:center; }
table{width:100%; border-collapse:collapse; margin-top:14px}
th,td{border:1px solid #e5e7eb; padding:8px; font-size:13px; text-align:center}
th{background:#dbeafe}
tr.ganado{background:#d1fae5}
tr.perdido{background:#fee2e2}
</style>
</head>
<body>
<main>
  <header>
    <h1>Poker Panel PRO</h1>
    <nav>
      <button class="tab active" data-tab="badbits">BadBits</button>
      <button class="tab" data-tab="flips">Flips</button>
      <button class="tab" data-tab="torneos">Torneos</button>
    </nav>
  </header>

  <section id="badbits" class="active">
    <h2>BadBits</h2>
    <table id="bb_table"><thead><tr><th>Fecha</th><th>Sala</th><th>Mi Mano</th><th>Rival</th><th>Equity</th><th>Resultado</th><th>Notas</th></tr></thead><tbody></tbody></table>
  </section>

  <section id="flips">
    <h2>Flips</h2>
    <table id="fp_table"><thead><tr><th>Fecha</th><th>Sala</th><th>Mi Mano</th><th>Rival</th><th>Equity</th><th>Resultado</th><th>Notas</th></tr></thead><tbody></tbody></table>
  </section>

  <section id="torneos">
    <h2>Torneos</h2>
    <table id="tr_table"><thead><tr><th>Fecha</th><th>Sala</th><th>Nombre</th><th>Buy-in</th><th>Fee</th><th>Premio</th><th>Entradas</th><th>Pos</th><th>Inv</th><th>Neto</th><th>ROI</th><th>Resultado</th><th>Notas</th></tr></thead><tbody></tbody></table>
  </section>
</main>

<script>
// ========= Tabs =========
const tabs = document.querySelectorAll('.tab');
const sections = document.querySelectorAll('section');
tabs.forEach(btn => btn.addEventListener('click', () => {
  tabs.forEach(b=>b.classList.remove('active'));
  sections.forEach(s=>s.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById(btn.dataset.tab).classList.add('active');
}));

// ========= Envío hacia Google Sheets =========
const ENDPOINT = "https://script.google.com/macros/s/AKfycbyXT-L1w6g535mhsomnkYj2h3Dwuyoq2Q004JRQoAG37ih43RJJEUY_YtSqxPXJZ_gN/exec";
function sendToSheets(payload) {
  try {
    fetch(ENDPOINT, {
      method:'POST',
      mode:'no-cors',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });
  } catch(e) { console.warn('Sheets error', e); }
}

// ========= Lectura desde Google Sheets =========
const SHEETS_BASE = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ3JGhQWGDeATRjmNOhe77Xpq62tuNBNWagin8wqnNVpE1qMAveRmcucV1bTilO-A3GsAG1bQtBJoO7/pub?output=csv&gid=";

async function cargarDatosDesdeSheets(gid, tableId, tipo) {
  const url = SHEETS_BASE + gid;
  const response = await fetch(url);
  const data = await response.text();
  const rows = data.split("\n").map(r => r.split(","));
  const tbody = document.querySelector(tableId + " tbody");
  if (!tbody) return;
  tbody.innerHTML = "";
  rows.slice(1).forEach(r => {
    if(r.length < 2) return;
    const tr = document.createElement("tr");
    if (tipo === "torneos") {
      const inv=(+r[3]||0)+(+r[4]||0);
      const neto=(+r[5]||0)-inv;
      const roi = inv>0 ? ((neto/inv)*100).toFixed(1)+'%' : '0%';
      tr.innerHTML = `<td>${r[0]}</td><td>${r[1]}</td><td>${r[2]}</td>
        <td>${r[3]}</td><td>${r[4]}</td><td>${r[5]}</td><td>${r[6]}</td><td>${r[7]}</td>
        <td>${inv.toFixed(2)}</td><td>${neto.toFixed(2)}</td><td>${roi}</td>
        <td>${r[8]}</td><td>${r[9]}</td>`;
      if(neto>=0) tr.classList.add('ganado'); else tr.classList.add('perdido');
    } else {
      tr.innerHTML = `<td>${r[0]}</td><td>${r[1]}</td><td>${r[2]}</td>
        <td>${r[3]}</td><td>${r[4]}</td><td>${r[5]}</td><td>${r[6]}</td>`;
      if((r[5]||"").toLowerCase()==="ganado") tr.classList.add('ganado');
      if((r[5]||"").toLowerCase()==="perdido") tr.classList.add('perdido');
    }
    tbody.appendChild(tr);
  });
}

// Carga inicial al abrir la página
document.addEventListener("DOMContentLoaded", () => {
  cargarDatosDesdeSheets("0", "#bb_table", "badbits");           // BadBits (gid=0)
  cargarDatosDesdeSheets("1232318966", "#fp_table", "flips");    // Flips
  cargarDatosDesdeSheets("541665909", "#tr_table", "torneos");   // Torneos
});
</script>
</body>
</html>