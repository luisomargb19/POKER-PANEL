<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Poker Panel PRO</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { margin:20px; font-family: Arial, sans-serif; background-color:#f8f9fa; }
.nav-tabs .nav-link.active { background-color:#0d6efd; color:white; }
section { margin-top: 20px; }
</style>
</head>
<body>
<h1 class="mb-4">Poker Panel PRO</h1>

<ul class="nav nav-tabs" id="panelTabs" role="tablist">
  <li class="nav-item"><a class="nav-link active" id="bb-tab" data-bs-toggle="tab" href="#bb" role="tab">BadBits</a></li>
  <li class="nav-item"><a class="nav-link" id="fp-tab" data-bs-toggle="tab" href="#fp" role="tab">Flips</a></li>
  <li class="nav-item"><a class="nav-link" id="tr-tab" data-bs-toggle="tab" href="#tr" role="tab">Torneos</a></li>
</ul>

<div class="tab-content mt-3">
  <div class="tab-pane fade show active" id="bb" role="tabpanel">
    <h3>BadBits</h3>
    <form id="bb_form" class="mb-3">
      <input name="fecha" type="date" class="form-control mb-2" required>
      <input name="sala" placeholder="Sala" class="form-control mb-2">
      <input name="mi_mano" placeholder="Mi Mano" class="form-control mb-2">
      <input name="mano_rival" placeholder="Rival" class="form-control mb-2">
      <input name="equity" placeholder="Equity" class="form-control mb-2">
      <select name="resultado" class="form-control mb-2">
        <option value="Ganado">Ganado</option>
        <option value="Perdido">Perdido</option>
      </select>
      <input name="notas" placeholder="Notas" class="form-control mb-2">
      <button type="submit" class="btn btn-success">Guardar BadBit</button>
    </form>
    <table id="bb_table" class="table table-bordered"></table>
  </div>

  <div class="tab-pane fade" id="fp" role="tabpanel">
    <h3>Flips</h3>
    <form id="fp_form" class="mb-3">
      <input name="fecha" type="date" class="form-control mb-2" required>
      <input name="sala" placeholder="Sala" class="form-control mb-2">
      <input name="mi_mano" placeholder="Mi Mano" class="form-control mb-2">
      <input name="mano_rival" placeholder="Rival" class="form-control mb-2">
      <input name="equity" placeholder="Equity" class="form-control mb-2">
      <select name="resultado" class="form-control mb-2">
        <option value="Ganado">Ganado</option>
        <option value="Perdido">Perdido</option>
      </select>
      <input name="notas" placeholder="Notas" class="form-control mb-2">
      <button type="submit" class="btn btn-primary">Guardar Flip</button>
    </form>
    <table id="fp_table" class="table table-bordered"></table>
  </div>

  <div class="tab-pane fade" id="tr" role="tabpanel">
    <h3>Torneos</h3>
    <form id="tr_form" class="mb-3">
      <input name="fecha" type="date" class="form-control mb-2" required>
      <input name="nombre" placeholder="Nombre Torneo" class="form-control mb-2">
      <input name="buyin" placeholder="Buyin" class="form-control mb-2">
      <input name="fee" placeholder="Fee" class="form-control mb-2">
      <input name="premio" placeholder="Premio" class="form-control mb-2">
      <input name="entradas" placeholder="Entradas" class="form-control mb-2">
      <input name="pos" placeholder="Posición" class="form-control mb-2">
      <input name="manos" placeholder="N° Manos" class="form-control mb-2">
      <button type="submit" class="btn btn-warning">Guardar Torneo</button>
    </form>
    <table id="tr_table" class="table table-bordered"></table>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
// ========= Sheets Endpoint =========
const ENDPOINT = "https://script.google.com/macros/s/AKfycbyQWyAdBoEQ5PVCB1EEiusKSejXQf8Ua9cG23z1VWcdCrOSGZtjglnMQPTRiEU6BECl1w/exec";

function sendToSheets(payload) {
  const body = new URLSearchParams({ data: JSON.stringify(payload) });
  fetch(ENDPOINT, {
    method: 'POST',
    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
    body
  })
  .then(r => r.text())
  .then(t => console.log("Sheets OK:", t))
  .catch(e => console.error("Sheets error:", e));
}

// ========= Storage =========
function saveData(key, data) { localStorage.setItem(key, JSON.stringify(data)); }
function loadData(key) { return JSON.parse(localStorage.getItem(key) || '[]'); }

// ========= Update Tables =========
function renderTable(id, data) {
  const table = document.getElementById(id);
  if (!table) return;
  if (data.length === 0) { table.innerHTML = "<tr><td>Sin datos</td></tr>"; return; }
  const headers = Object.keys(data[0]);
  let html = "<tr>" + headers.map(h=>"<th>"+h+"</th>").join("") + "</tr>";
  for (const row of data) {
    html += "<tr>" + headers.map(h=>"<td>"+(row[h]||"")+"</td>").join("") + "</tr>";
  }
  table.innerHTML = html;
}

function updateAll() {
  renderTable('bb_table', loadData('badbits'));
  renderTable('fp_table', loadData('flips'));
  renderTable('tr_table', loadData('torneos'));
}

// ========= Forms =========
document.getElementById('bb_form').onsubmit = function(e){
  e.preventDefault();
  const row=Object.fromEntries(new FormData(e.target).entries());
  const arr=loadData('badbits'); arr.push(row);
  saveData('badbits',arr); sendToSheets(Object.assign({tipo:'BadBit'}, row));
  e.target.reset(); updateAll();
};
document.getElementById('fp_form').onsubmit = function(e){
  e.preventDefault();
  const row=Object.fromEntries(new FormData(e.target).entries());
  const arr=loadData('flips'); arr.push(row);
  saveData('flips',arr); sendToSheets(Object.assign({tipo:'Flip'}, row));
  e.target.reset(); updateAll();
};
document.getElementById('tr_form').onsubmit = function(e){
  e.preventDefault();
  const row=Object.fromEntries(new FormData(e.target).entries());
  const arr=loadData('torneos'); arr.push(row);
  saveData('torneos',arr); sendToSheets(Object.assign({tipo:'Torneo'}, row));
  e.target.reset(); updateAll();
};

updateAll();
</script>
</body>
</html>
